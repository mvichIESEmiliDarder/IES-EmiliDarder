## Instalación de Apache

Para instalar el servidor web **Apache2** en Ubuntu, primero actualiza la lista de paquetes y luego instala el servidor:

```bash
sudo apt update
sudo apt install apache2
```

-----

### 📋 Verificación y Control del Servicio

Una vez instalado, el servicio de Apache2 (el paquete es `apache2`) debería iniciarse automáticamente.

| Comando | Propósito |
| :--- | :--- |
| `sudo systemctl status apache2` | Verifica si Apache está corriendo y su estado actual. |
| `sudo systemctl enable apache2` | Asegura que Apache se inicie automáticamente al arrancar el sistema. (Generalmente se habilita por defecto con la instalación). |
| `sudo ufw allow 'Apache Full'` | Abre el firewall (UFW) para el tráfico **HTTP** (puerto 80) y **HTTPS** (puerto 443). |

#### Otros Comandos Útiles

| Comando | Propósito |
| :--- | :--- |
| `sudo systemctl start apache2` | Inicia el servicio de Apache2. |
| `sudo systemctl stop apache2` | Detiene el servicio de Apache2. |
| `sudo systemctl restart apache2` | Detiene y luego inicia el servicio (útil después de cambios mayores en la configuración). |
| `sudo systemctl reload apache2` | Recarga la configuración sin interrumpir las conexiones actuales (útil después de cambios menores). |

-----

### 🌐 Perfiles de UFW para Apache

Apache registra varios perfiles con UFW que puedes usar para controlar el acceso:

  * **`Apache`**: Abre solo el puerto **80** (HTTP, tráfico no cifrado).
  * **`Apache Secure`**: Abre solo el puerto **443** (HTTPS, tráfico cifrado).
  * **`Apache Full`**: Abre **ambos** puertos 80 y 443. (El equivalente al `Nginx Full` que mencionaste).

Puedes ver los perfiles disponibles con `sudo ufw app list`.

---

Resumen de los pasos y la lógica para configurar **Virtual Hosts** (servidores virtuales) en Apache2.

### 1. La Lógica de Configuración: Archivos y Directorios

Apache se gestiona principalmente a través de dos tipos de archivos de configuración:

- **Configuración General:** El archivo principal, usualmente en `/etc/apache2/apache2.conf` (en lugar de `apache.conf`), contiene directivas globales que afectan a todo el servidor.
    
- **Configuraciones de Sitios (Virtual Hosts):** Se organizan en dos directorios:
    
    - `/etc/apache2/sites-available`: Contiene archivos de configuración de sitios que **pueden** usarse.
        
    - `/etc/apache2/sites-enabled`: Contiene **enlaces simbólicos** a los archivos de `sites-available` para los sitios que **están** activos.
        

|**Directorio**|**Propósito**|
|---|---|
|`/etc/apache2/sites-available`|Plantillas y configuraciones listas para activar.|
|`/etc/apache2/sites-enabled`|Sitios web actualmente **activos** (enlaces simbólicos).|

---

### 2. Creación y Configuración del Nuevo Sitio

El objetivo de los _Virtual Hosts_ es servir múltiples **dominios** (URLs) desde el mismo servidor (ej. `www.tienda-bici.es` y `www.hostal-cama.com`).

1. **Copiar la Plantilla:** Usa la plantilla de configuración predeterminada para tu nuevo sitio.
    
    Bash
    
    ```
    cd /etc/apache2/sites-available
    sudo cp 000-default.conf tu_sitio.conf
    ```
    
2. **Configurar el Archivo `tu_sitio.conf`:** Edita este nuevo archivo. Las directivas clave que **debes** configurar dentro del bloque `<VirtualHost>` son:
    
    - **`ServerName`:** La **URL/dominio** con el que se accederá al sitio (ej. `www.tu_sitio.com`). **¡Esto es crucial!**
        
    - **`DocumentRoot`:** El **directorio raíz** donde se encuentran los archivos de tu sitio web (ej. `/var/www/tu_sitio`).
        
    - **`ServerAlias` (Opcional):** Nombres de dominio adicionales para el mismo sitio (ej. `tu_sitio.com`).
        

---

### 3. Activación y Recarga

Una vez configurado el archivo `.conf`, sigue estos pasos para activarlo:

1. **Habilitar el Sitio:** Usa el comando `a2ensite` para crear el enlace simbólico y activar el sitio.
    
    Bash
    
    ```
    sudo a2ensite tu_sitio.conf
    ```
    
2. **Verificar la Sintaxis:** Antes de recargar, asegúrate de que la configuración no tiene errores de sintaxis.
    
    Bash
    
    ```
    sudo apachectl configtest
    ```
    
    _(Debe responder: `Syntax OK`)_
    
3. **Recargar Apache:** Aplica los cambios sin interrumpir el servicio.
    
    Bash
    
    ```
    sudo systemctl reload apache2
    ```
    
    _Para un cambio mayor o si la recarga falla, usa `restart`._
    

---

### ⚠️ Aclaraciones sobre las Directivas

- La directiva **`DocumentRoot`** es la clave para indicar dónde están los archivos del sitio.
    
- **`ServerName`** es la clave para el _Virtual Host_, diciendo qué URL debe responder con esta configuración.
    
- **IP y Puerto** (ej. `<VirtualHost *:80>`) casi siempre se dejan en `*:80` (todas las IP en el puerto estándar HTTP).
    
- La directiva **`port`** no se usa dentro de los archivos de _sites-available_; el puerto se define en el bloque `<VirtualHost *:80>` y se escucha globalmente en otro archivo (`ports.conf`).