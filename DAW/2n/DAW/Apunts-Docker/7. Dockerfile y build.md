# Dockerfile – Guía rápida  
*(Diapositivas en formato Markdown)*  

---

## 1️⃣ ¿Qué es un Dockerfile?

| Concepto | Descripción |
|----------|-------------|
| **Dockerfile** | Texto con instrucciones que Docker ejecuta para construir una imagen. |
| Cada instrucción crea una *capa* (layer). |
| Se escribe línea por línea, cada línea = 1 instrucción. |

---

## 2️⃣ Instrucciones básicas

| Instrucción | Función | Ejemplo breve |
|-------------|---------|---------------|
| `FROM` | Imagen base | `FROM nginx:alpine` |
| `RUN` | Ejecuta comandos dentro de la imagen | `RUN pip install -r requirements.txt` |
| `COPY` | Copia archivos del host a la imagen | `COPY index.html /usr/share/nginx/html/` |
| `WORKDIR` | Define directorio de trabajo | `WORKDIR /app` |
| `CMD` | Comando que se ejecuta al iniciar contenedor | `CMD ["python", "script.py"]` |
| `ENTRYPOINT` | Similar a CMD, pero no sobrescribible | `ENTRYPOINT ["python"]` |

> **Tip**: Hay más instrucciones (ENV, EXPOSE, VOLUME, etc.), pero estas son las esenciales.

---

## 3️⃣ Ejemplo 1 – Nginx

### 3.1 Código HTML  
```html
<!DOCTYPE html>
<html>
<head><title>¡Hola Dockermaníaco!</title></head>
<body>
  <h1>¡Hola Dockermaníaco!</h1>
  <p>No olvides suscribirte a mi canal de Youtube y darle una estrellita al repositorio de Github.</p>
</body>
</html>
```

### 3.2 Dockerfile  
```dockerfile
# Utilizamos la imagen oficial de Nginx
FROM nginx:alpine

# Copiamos el fichero index.html al directorio adecuado
COPY index.html /usr/share/nginx/html/index.html
```

---

## 4️⃣ Ejemplo 2 – Script Python

### 4.1 Código Python  
```python
import time

while True:
    print("¡Hola Dockermaníaco!")
    time.sleep(1)
```

### 4.2 Dockerfile básico  
```dockerfile
FROM python:alpine
WORKDIR /app
COPY script.py .
CMD ["python", "script.py"]
```

---

## 5️⃣ Añadiendo dependencias

### 5.1 `requirements.txt`  
```
requests
```

### 5.2 Dockerfile con pip install  
```dockerfile
FROM python:alpine
WORKDIR /app
COPY script.py .
COPY requirements.txt .
RUN pip install -r requirements.txt
CMD ["python", "script.py"]
```

> **Problema**: Cada vez que cambias `script.py`, se reinstala todo.

---

## 6️⃣ Optimización – Reordenar capas

```dockerfile
FROM python:alpine
WORKDIR /app

# 1. Copia y instala dependencias (capa caché)
COPY requirements.txt .
RUN pip install -r requirements.txt

# 2. Copia el script (solo cambia cuando lo cambies)
COPY script.py .

CMD ["python", "script.py"]
```

- Si solo modificas `script.py`, Docker reutiliza la capa de dependencias → **build más rápido**.

---

## 7️⃣ Construir imágenes

```bash
# Nginx
docker build -t mi-nginx .

# Python
docker build -t mi-python .
```

> Usa `.` para indicar que el contexto es el directorio actual.  
> El flag `-t` asigna nombre y etiqueta.

---

## 8️⃣ Ejecutar contenedores

```bash
# Nginx: puerto 80 → 8080 del host
docker run -d --name mi-nginx -p 8080:80 mi-nginx

# Python: solo en background
docker run -d --name mi-python mi-python
```

- `-d`: modo detached (background).  
- `--name`: nombre amigable para el contenedor.  
- `-p`: mapeo de puertos.

---

## 9️⃣ Verificar

```bash
# Listar imágenes
docker images

# Listar contenedores activos
docker ps
```

Visita <http://localhost:8080> en tu navegador y verás el **index.html** servido por Nginx.  
El script Python seguirá imprimiendo “¡Hola Dockermaníaco!” en los logs del contenedor (`docker logs mi-python`).

---

