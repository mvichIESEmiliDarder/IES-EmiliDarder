# Docker Images  

---

## 1Ô∏è‚É£ ¬øQu√© es una imagen?  

Una **Imagen de Contenedor** (o simplemente "Imagen") es un **paquete inmutable** y **ejecutable** que contiene el c√≥digo de una aplicaci√≥n, las librer√≠as, las dependencias, el entorno y los archivos de configuraci√≥n necesarios para que la aplicaci√≥n se ejecute.

En el contexto de Docker y OCI:

1. **Receta (Dockerfile):** Es el conjunto de **instrucciones** para construir la imagen.
    
2. **Imagen:** Es el **paquete est√°tico** y **pre-compilado** que resulta de seguir esas instrucciones.
    
3. **Contenedor:** Es la **instancia en ejecuci√≥n** de esa Imagen.

### Caracter√≠sticas Clave

- **Inmutable y Est√°tica:** Una vez que se construye una Imagen, **no puede ser modificada**. Si necesitas hacer un cambio, debes construir una **nueva imagen**. Esto garantiza que la imagen que se prueba es exactamente la misma que se desplegar√° en producci√≥n.
    
- **Sistema de Capas:** Las Im√°genes se construyen utilizando un sistema de **archivos por capas**. Cada instrucci√≥n en el `Dockerfile` (como `FROM`, `RUN`, `COPY`) crea una nueva **capa de solo lectura** sobre la capa anterior. Esto hace que las im√°genes sean muy eficientes en el almacenamiento y la transferencia, ya que las capas comunes pueden ser compartidas entre diferentes im√°genes.
    
- **Base para Contenedores:** La Imagen es la **plantilla** a partir de la cual se crea un **Contenedor** en ejecuci√≥n. Cuando se inicia un Contenedor, se a√±ade una **capa de escritura** temporal encima de las capas de solo lectura de la Imagen para almacenar cualquier cambio que ocurra durante el tiempo de ejecuci√≥n.
    

En resumen, la **Imagen** es la **unidad empaquetada y transportable** que contiene todo lo necesario, mientras que el **Contenedor** es el proceso activo y aislado que se inicia a partir de esa Imagen.


- Contiene **todos los elementos** necesarios para ejecutar un contenedor.  
- Funciona como una *plantilla* que se utiliza para crear contenedores.  

---

## 2Ô∏è‚É£ Propiedades clave de las im√°genes  
### Inmutabilidad  
- Una vez creada, **no puede modificarse**.  
- Para cambiar algo, se crea una nueva imagen (desde la anterior o desde cero).  
- Permite controlar versiones y garantizar consistencia en cualquier entorno.  

### Capas  
- La imagen est√° compuesta por **una serie de capas**.  
- Cada capa representa un cambio concreto del sistema de archivos.  
- Las capas pueden ser reutilizadas entre im√°genes, reduciendo tama√±o y tiempo de construcci√≥n.  

### Base para contenedores

- Es la **plantilla** de solo lectura a partir de la cual se lanza una o varias **instancias de contenedor** en ejecuci√≥n.
- Al iniciar un contenedor, Docker a√±ade una **capa de escritura temporal** encima de las capas de la imagen para registrar cualquier cambio del tiempo de ejecuci√≥n.
- Esto garantiza que m√∫ltiples contenedores compartan eficientemente la misma imagen base sin interferir entre s√≠.

---

## 2Ô∏è‚É£.5Ô∏è‚É£ üíæ Estructura de Capas Detallada y *Union File System*

La eficiencia de Docker se basa en c√≥mo organiza el sistema de archivos de una imagen. Las im√°genes se construyen como un **stack** de capas de solo lectura, usando un sistema conocido como **Union File System**.

### 1\. Capas de Solo Lectura (Read-Only Layers)

  * **Cada instrucci√≥n en el `Dockerfile`** (`FROM`, `RUN`, `COPY`, etc.) genera una nueva **capa inmutable** de solo lectura.
  * Estas capas est√°n apiladas, y cada una contiene solo la **diferencia** (delta) con respecto a la capa inferior.

### 2\. El Union File System

  * Este mecanismo superpone todas las capas de solo lectura de la imagen de forma transparente.
  * El contenedor ve un **sistema de archivos unificado** que parece ser un sistema operativo completo.

### 3\. Capa de Lectura/Escritura (Read-Write Layer)

  * Cuando se inicia un contenedor, Docker a√±ade una **capa adicional de lectura/escritura (R/W)** en la parte superior del stack.
  * **Todos los cambios** realizados por el contenedor en ejecuci√≥n (nuevos archivos, modificaciones, eliminaciones) se registran **√∫nicamente** en esta capa superior.
  * Esta capa R/W es **ef√≠mera**: se elimina cuando el contenedor se detiene y se borra, dejando la imagen base sin cambios.

### 4\. Principio de *Copy-on-Write* (CoW)

  * Para gestionar las modificaciones, Docker utiliza CoW.
  * Si un proceso intenta modificar un archivo que existe en una capa inferior (de solo lectura), Docker **primero copia** ese archivo a la capa R/W superior y luego aplica el cambio all√≠.
  * Esto asegura que las capas base permanezcan intactas y permite que m√∫ltiples contenedores compartan la misma imagen base de forma segura y eficiente.

---

## 3Ô∏è‚É£ Estructura pr√°ctica: Capas en acci√≥n  

```bash
# Descargar im√°genes de ejemplo
docker pull nginx
docker pull alpine
```

### Ver historial (capas)  
```bash
docker history nginx
docker history alpine
```
- Cada l√≠nea corresponde a una capa con su propia funcionalidad (ej. instalaci√≥n, configuraci√≥n).  

---

## 4Ô∏è‚É£ Imagen basada en Alpine ‚Äì Ejemplo concreto  
```bash
docker pull alpine:3.19
docker pull nginx:stable-alpine3.19
```

**Observaci√≥n:**  
Al hacer `pull` de la imagen `nginx:stable-alpine3.19`, Docker comparte una capa con `alpine:3.19`.  
Ejemplo del output:

```text
bca4290a9639: Already exists <--- Capa compartida con alpine
32b20be2efbb: Pull complete
...
```

---

## 5Ô∏è‚É£ Ventajas de las capas  
- **Eficiencia de almacenamiento:** solo se descargan capas nuevas.  
- **Rapidez en la creaci√≥n de contenedores:** Docker monta las capas existentes localmente.  

---

## 6Ô∏è‚É£ Gesti√≥n de im√°genes ‚Äì Borrar una imagen  
1. Listar im√°genes locales:  
   ```bash
   docker images
   ```
2. Eliminar por nombre:  
   ```bash
   docker rmi nginx
   ```
3. Eliminar por ID (ejemplo):  
   ```bash
   docker rmi 7faa5d3a2af2
   ```

---

## 7Ô∏è‚É£ Prune de im√°genes ‚Äì Limpiar lo que no se usa  
- Elimina **todas** las im√°genes que no est√°n asociadas a ning√∫n contenedor.  

```bash
docker image prune
```
> Se recomienda revisar antes con `docker images` para evitar eliminar accidentalmente algo necesario.

---

## 8Ô∏è‚É£ Resumen r√°pido  
| Tema | Concepto |
|------|----------|
| **Imagen** | Plantilla de un contenedor |
| **Inmutabilidad** | No se puede cambiar una vez creada |
| **Capas** | Cambios aislados, reutilizables |
| **Historial** | `docker history` muestra capas |
| **Pull compartido** | Capas comunes entre im√°genes |
| **Borrar** | `docker rmi <id/nombre>` |
| **Prune** | `docker image prune` elimina sin uso |

---

### ¬°Listo!  
Con estos conceptos podr√°s manejar y optimizar las im√°genes Docker de forma eficiente.