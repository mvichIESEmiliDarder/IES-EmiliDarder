# Docker Images  

---

## 1️⃣ ¿Qué es una imagen?  

Una **Imagen de Contenedor** (o simplemente "Imagen") es un **paquete inmutable** y **ejecutable** que contiene el código de una aplicación, las librerías, las dependencias, el entorno y los archivos de configuración necesarios para que la aplicación se ejecute.

En el contexto de Docker y OCI:

1. **Receta (Dockerfile):** Es el conjunto de **instrucciones** para construir la imagen.
    
2. **Imagen:** Es el **paquete estático** y **pre-compilado** que resulta de seguir esas instrucciones.
    
3. **Contenedor:** Es la **instancia en ejecución** de esa Imagen.

### Características Clave

- **Inmutable y Estática:** Una vez que se construye una Imagen, **no puede ser modificada**. Si necesitas hacer un cambio, debes construir una **nueva imagen**. Esto garantiza que la imagen que se prueba es exactamente la misma que se desplegará en producción.
    
- **Sistema de Capas:** Las Imágenes se construyen utilizando un sistema de **archivos por capas**. Cada instrucción en el `Dockerfile` (como `FROM`, `RUN`, `COPY`) crea una nueva **capa de solo lectura** sobre la capa anterior. Esto hace que las imágenes sean muy eficientes en el almacenamiento y la transferencia, ya que las capas comunes pueden ser compartidas entre diferentes imágenes.
    
- **Base para Contenedores:** La Imagen es la **plantilla** a partir de la cual se crea un **Contenedor** en ejecución. Cuando se inicia un Contenedor, se añade una **capa de escritura** temporal encima de las capas de solo lectura de la Imagen para almacenar cualquier cambio que ocurra durante el tiempo de ejecución.
    

En resumen, la **Imagen** es la **unidad empaquetada y transportable** que contiene todo lo necesario, mientras que el **Contenedor** es el proceso activo y aislado que se inicia a partir de esa Imagen.


- Contiene **todos los elementos** necesarios para ejecutar un contenedor.  
- Funciona como una *plantilla* que se utiliza para crear contenedores.  

---

## 2️⃣ Propiedades clave de las imágenes  
### Inmutabilidad  
- Una vez creada, **no puede modificarse**.  
- Para cambiar algo, se crea una nueva imagen (desde la anterior o desde cero).  
- Permite controlar versiones y garantizar consistencia en cualquier entorno.  

### Capas  
- La imagen está compuesta por **una serie de capas**.  
- Cada capa representa un cambio concreto del sistema de archivos.  
- Las capas pueden ser reutilizadas entre imágenes, reduciendo tamaño y tiempo de construcción.  

### Base para contenedores

- Es la **plantilla** de solo lectura a partir de la cual se lanza una o varias **instancias de contenedor** en ejecución.
- Al iniciar un contenedor, Docker añade una **capa de escritura temporal** encima de las capas de la imagen para registrar cualquier cambio del tiempo de ejecución.
- Esto garantiza que múltiples contenedores compartan eficientemente la misma imagen base sin interferir entre sí.

---

## 3️⃣ Estructura práctica: Capas en acción  

```bash
# Descargar imágenes de ejemplo
docker pull nginx
docker pull alpine
```

### Ver historial (capas)  
```bash
docker history nginx
docker history alpine
```
- Cada línea corresponde a una capa con su propia funcionalidad (ej. instalación, configuración).  

---

## 4. Imagen basada en Alpine – Ejemplo concreto  
```bash
docker pull alpine:3.19
docker pull nginx:stable-alpine3.19
```

**Observación:**  
Al hacer `pull` de la imagen `nginx:stable-alpine3.19`, Docker comparte una capa con `alpine:3.19`.  
Ejemplo del output:

```text
bca4290a9639: Already exists <--- Capa compartida con alpine
32b20be2efbb: Pull complete
...
```

---

## 5. Ventajas de las capas  
- **Eficiencia de almacenamiento:** solo se descargan capas nuevas.  
- **Rapidez en la creación de contenedores:** Docker monta las capas existentes localmente.  

---

## 6. Gestión de imágenes – Borrar una imagen  
1. Listar imágenes locales:  
   ```bash
   docker images
   ```
2. Eliminar por nombre:  
   ```bash
   docker rmi nginx
   ```
3. Eliminar por ID (ejemplo):  
   ```bash
   docker rmi 7faa5d3a2af2
   ```

---

## 7. Prune de imágenes – Limpiar lo que no se usa  
- Elimina **todas** las imágenes que no están asociadas a ningún contenedor.  

```bash
docker image prune
```
> Se recomienda revisar antes con `docker images` para evitar eliminar accidentalmente algo necesario.

---

## 8. Resumen rápido  
| Tema | Concepto |
|------|----------|
| **Imagen** | Plantilla de un contenedor |
| **Inmutabilidad** | No se puede cambiar una vez creada |
| **Capas** | Cambios aislados, reutilizables |
| **Historial** | `docker history` muestra capas |
| **Pull compartido** | Capas comunes entre imágenes |
| **Borrar** | `docker rmi <id/nombre>` |
| **Prune** | `docker image prune` elimina sin uso |

---

### ¡Listo!  
Con estos conceptos podrás manejar y optimizar las imágenes Docker de forma eficiente.