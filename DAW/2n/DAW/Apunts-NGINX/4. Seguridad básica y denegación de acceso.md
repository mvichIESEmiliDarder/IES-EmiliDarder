# Seguridad B√°sica y Denegaci√≥n de Acceso en NGINX üõ°Ô∏è

En NGINX, la seguridad b√°sica se logra mediante dos t√©cnicas fundamentales: la **ofuscaci√≥n** de la informaci√≥n sensible del servidor y el **control granular de acceso** a las URI (rutas web) usando directivas sencillas de permisos.

-----

## 1\. Directivas de Ofuscaci√≥n (Ocultar la Versi√≥n)

Ocultar la versi√≥n exacta de NGINX es una pr√°ctica esencial de **seguridad por ofuscaci√≥n**. Al no revelar la versi√≥n en las cabeceras HTTP, se dificulta que un atacante lance ataques dirigidos a vulnerabilidades conocidas de una versi√≥n espec√≠fica.

‚ö†Ô∏è NGINX est√° dise√±ado para ser muy minimalista en su informaci√≥n por defecto. Sin embargo, se puede eliminar la menci√≥n de la versi√≥n espec√≠fica con una √∫nica directiva global.

### A. Control de la Cabecera HTTP: `server_tokens`

Esta directiva controla cu√°nta informaci√≥n sobre el servidor se revela en la **cabecera HTTP de respuesta** (`Server:`) y en los mensajes de error. Se configura en el contexto **`http`** o **`server`**.

| Valor | Cabecera `Server:` (Ejemplo) | Descripci√≥n |
| :--- | :--- | :--- |
| `on` (Predeterminado) | `nginx/1.22.1` | Muestra el nombre del producto y la versi√≥n espec√≠fica. |
| **`off`** | **`nginx`** | **Recomendado.** Muestra solo el nombre del producto (`nginx`). Oculta la versi√≥n y el n√∫mero de compilaci√≥n. |
| `build` | `nginx/1.22.1 (Ubuntu)` | Muestra informaci√≥n adicional de la compilaci√≥n (poco com√∫n). |

**Configuraci√≥n de Seguridad Recomendada:**

```nginx
server_tokens off;
```

> **Diferencia con Apache:** En NGINX, la configuraci√≥n `server_tokens off;` afecta tanto a la cabecera HTTP como a las p√°ginas de error generadas por el servidor (simulando la funci√≥n de `ServerSignature Off` en Apache).

-----

## 2\. Control Granular de Acceso (Denegaci√≥n)

NGINX utiliza las directivas **`allow`** y **`deny`** para implementar reglas de acceso a nivel de red (IP) dentro de los bloques **`http`**, **`server`** o, m√°s com√∫nmente, **`location`**.

### A. `allow` y `deny` (Permisos basados en IP)

Estas directivas controlan el acceso a recursos espec√≠ficos seg√∫n la direcci√≥n IP de origen de la solicitud. Su orden de aparici√≥n es crucial.

| Directiva | Funci√≥n | Aplicaci√≥n T√≠pica |
| :--- | :--- | :--- |
| **`deny`** | Bloquea el acceso a la IP o rango especificado. | Denegar el acceso a directorios sensibles. |
| **`allow`** | Permite el acceso a la IP o rango especificado. | Abrir el acceso a un servicio solo para la red interna. |

### B. Protegiendo Directorios Sensibles (Ejemplo)

Para proteger un directorio web sensible (ej. `/admin/` o `.git/`) de todo acceso p√∫blico, aplicas las reglas de `deny` dentro del bloque `location` correspondiente:

```nginx
location /admin/ {
    # 1. Denegar el acceso a todas las IPs
    deny all; 
    
    # 2. Permitir expl√≠citamente el acceso a la IP de la oficina o administrador
    allow 203.0.113.42; 

    # 3. Deshabilitar el listado de archivos (equivalente a Options -Indexes)
    autoindex off;
}
```

En este ejemplo, NGINX:

1.  **Deniega** el acceso a todos (`deny all;`).
2.  **Sobrescribe** la denegaci√≥n para una IP espec√≠fica (`allow 203.0.113.42;`), permiti√©ndole el acceso.

**Caso de Uso T√≠pico: Bloquear archivos ocultos (simulando parte de `.htaccess`):**

```nginx
# Deniega el acceso a cualquier archivo que empiece por punto (ej. .htaccess, .git, .env)
location ~ /\. {
    deny all;
}
```

-----

## 3\. Aplicaci√≥n y Verificaci√≥n de los Cambios

Para que la nueva configuraci√≥n de seguridad surta efecto, debes seguir los pasos de recarga de NGINX:

1.  **Edita la Configuraci√≥n:** Aseg√∫rate de que `server_tokens off;` est√© en el contexto `http` (o en un bloque `server` si solo quieres que aplique a un sitio) y que las reglas `deny/allow` est√©n en el `location` correcto.

2.  **Verifica la Sintaxis:** Antes de recargar, comprueba que no hay errores de sintaxis en el archivo.

    ```bash
    sudo nginx -t
    ```

3.  **Reinicia el Servicio:** Recarga el servicio para aplicar la nueva configuraci√≥n.

    ```bash
    sudo systemctl reload nginx
    ```

Tras estos cambios, la cabecera `Server:` en tus respuestas HTTP solo deber√≠a mostrarse como **`Server: nginx`**, y las peticiones a rutas restringidas ser√°n bloqueadas seg√∫n las reglas de IP definidas.