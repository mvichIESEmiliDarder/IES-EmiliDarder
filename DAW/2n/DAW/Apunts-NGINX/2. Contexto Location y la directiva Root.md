# El Contexto `location` y la Directiva `root` en NGINX

La directiva **`<Directory>`** de Apache, que mapea a una **ruta f칤sica** del sistema de ficheros, **no existe** en NGINX. En NGINX, la configuraci칩n se organiza principalmente en torno a **URIs (rutas web)** utilizando el **contexto `location`** y la directiva **`root`**.

El contexto `location` es el mecanismo clave para aplicar un conjunto de configuraciones espec칤ficas a un subconjunto de peticiones bas치ndose en la **ruta web solicitada** (ej. `/blog/`, `/assets/`).

-----

## 1\. Concepto y Funci칩n Principal

### El Contexto `location`

El **bloque `location`** act칰a como un contenedor que permite aplicar un conjunto de configuraciones (otras directivas) a las peticiones cuya URI coincida con el patr칩n especificado.

Su funci칩n principal es el **enrutamiento y control granular** basado en la URL. Permite que, por ejemplo, los archivos est치ticos se sirvan de una manera, mientras que las peticiones de API se env칤an a un servidor *backend* diferente.

  - **丘멆잺 Importante:** El patr칩n que se especifica en el `location` es una **URI (ruta web)** solicitada por el cliente (ej. `/images/`), **no** una ruta f칤sica del sistema de ficheros. El mapeo al sistema de ficheros lo realiza la directiva **`root`**.

### La Directiva `root`

La directiva **`root`** define la **ruta base del sistema de archivos** a partir de la cual NGINX buscar치 el archivo que coincide con la URI solicitada.

  - Si `root` se define en el bloque **`server`**, es la ra칤z para todo el sitio.
  - Si se define en el bloque **`location`**, sobrescribe la ra칤z para las peticiones que coincidan con esa ruta web.

NGINX

```nginx
# Estructura b치sica
location /patron/de/uri/ {
    # Directivas que solo aplican a este patr칩n
    root /ruta/fisica/nueva;
    index index.html;
}
```

-----

## 2\. Directivas Clave Dentro de `location`

Dentro de un bloque `location`, las directivas controlan el mapeo de ficheros, la funcionalidad y el acceso.

### A. `index` (Archivos de 칈ndice)

Controla los nombres de archivo que NGINX intentar치 buscar y servir cuando se solicita un directorio (ej. una petici칩n a `/blog/` en lugar de `/blog/pagina.html`).

| Directiva en NGINX | Significado |
| :--- | :--- |
| **`index index.html index.htm;`** | NGINX busca `index.html` o `index.htm` en la ruta. |

> **游눠 Nota sobre `Indexes`:** La funcionalidad `Options Indexes` de Apache (listado de directorios) se habilita en NGINX usando la directiva **`autoindex on;`** dentro del bloque `location` o `server`.

### B. `try_files` (Manejo de Solicitudes y Reescritura)

Esta directiva es la forma m치s poderosa y eficiente de manejar la l칩gica de enrutamiento y la ausencia de archivos, similar a c칩mo se manejaban las reescrituras de URL en `.htaccess` de Apache.

| Directiva en NGINX | Significado |
| :--- | :--- |
| **`try_files $uri $uri/ =404;`** | 1. Busca un archivo que coincida con la URI (`$uri`). 2. Si no lo encuentra, busca un directorio (`$uri/`). 3. Si tampoco lo encuentra, devuelve un error 404. |
| **`try_files $uri /index.php;`** | Si el archivo solicitado no existe, la petici칩n se env칤a internamente al fichero `/index.php` para que lo procese (t칤pico en frameworks o CMS). |

### C. Restricciones de Acceso

En NGINX, el control de acceso a un `location` espec칤fico se realiza con las directivas **`allow`** y **`deny`**.

| Directiva en NGINX | Equivalencia en Apache (`Require`) | Significado |
| :--- | :--- | :--- |
| **`allow all;`** | `Require all granted` | Permite el acceso a todos. |
| **`deny all;`** | `Require all denied` | Deniega el acceso a todos. |
| **`allow 192.168.1.0/24;`** `deny all;` | `Require ip 192.168.1.0/24` | Permite solo esa subred; deniega el resto. |

-----

## 3\. Ejemplo Explicado

**Objetivo de Apache:** Aplicar configuraciones espec칤ficas a la ruta f칤sica `/var/www/ejemplo.com/public_html`.

**Objetivo de NGINX:** Aplicar configuraciones espec칤ficas a la **URI ra칤z** (`/`) y prohibir el acceso a un subdirectorio **web** (`/privado/`).

NGINX

```nginx
server {
    # 1. Configuraci칩n del sistema de ficheros base para el sitio.
    root /var/www/ejemplo.com/public_html;
    
    location / {
        # 2. Funcionalidad: Si la URI coincide con '/', NGINX busca
        # index.html en la ruta 'root' (/var/www/...).
        index index.html index.htm;
        
        # 3. Acceso: Todos pueden acceder.
        allow all;
    }

    # 4. Caso de Uso T칤pico: Protegiendo un Directorio Web
    location /privado/ {
        # El mapeo de ficheros ya lo hace 'root' del server, a menos que se use 'alias'.
        
        # 5. Deshabilitar listado de archivos (equivalente a Options -Indexes)
        autoindex off;
        
        # 6. Seguridad: Denegar el acceso a la URL /privado/
        deny all;
    }
}
```

Esta configuraci칩n logra cosas clave en NGINX:

1.  **Mapeo de Ficheros (`root`):** Todas las peticiones comienzan buscando archivos dentro de `/var/www/ejemplo.com/public_html`.
2.  **Enrutamiento (`location /`):** Define el comportamiento por defecto (servir `index.html`).
3.  **Protecci칩n (`location /privado/`):** Aplica la regla `deny all;` **solo** a las peticiones cuya URL empiece por `/privado/`, independientemente de d칩nde se encuentre esa carpeta f칤sicamente en el disco.
