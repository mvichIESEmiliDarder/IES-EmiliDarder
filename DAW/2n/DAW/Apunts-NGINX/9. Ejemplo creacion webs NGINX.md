
## 游 Gu칤a R치pida: Nginx y M칰ltiples Sitios Web

### 1\. Instalaci칩n y Preparaci칩n de Nginx

Instala Nginx y ajusta el firewall (UFW):

```bash
# 1. Actualizar e Instalar Nginx
sudo apt update
sudo apt install nginx

# 2. Abrir el Firewall para HTTP y HTTPS
sudo ufw allow 'Nginx Full'

# 3. Verificar el estado del servicio
sudo systemctl status nginx
```

-----

### 2\. Preparaci칩n del Sistema de Archivos

Crea las estructuras de directorios y ajusta los permisos. Usaremos `/var/www/` como ra칤z.

```bash
# 1. Crear las carpetas ra칤z de los dos sitios
sudo mkdir -p /var/www/siurells.local/html
sudo mkdir -p /var/www/ximbombes.local/html

# 2. Crear las subcarpetas requeridas
sudo mkdir -p /var/www/siurells.local/html/nomines
sudo mkdir -p /var/www/siurells.local/html/productes

sudo mkdir -p /var/www/ximbombes.local/html/nomines
sudo mkdir -p /var/www/ximbombes.local/html/productes

# 3. Crear archivos de prueba (index.html)
echo "<h1>Benvinguts a Siurells!</h1>" | sudo tee /var/www/siurells.local/html/index.html
echo "<h1>Benvinguts a Ximbombes!</h1>" | sudo tee /var/www/ximbombes.local/html/index.html

# 4. Asignar propiedad a www-data (usuario de Nginx) para seguridad
sudo chown -R www-data:www-data /var/www/siurells.local
sudo chown -R www-data:www-data /var/www/ximbombes.local
```

-----

### 3\. Configuraci칩n de Bloques de Servidor (Server Blocks)

Vamos a configurar los dos sitios web en archivos separados dentro de `/etc/nginx/sites-available/`.

#### A. Configuraci칩n para `www.siurells.local`

Crea y edita el archivo: `sudo nano /etc/nginx/sites-available/siurells.local.conf`

```nginx
server {
    listen 80;
    listen [::]:80;

    server_name siurells.local www.siurells.local;
    root /var/www/siurells.local/html;
    index index.html index.htm;
    
    # 3. Requisito: La carpeta ra칤z (index.html) NO debe listarse
    # (Comportamiento por defecto de Nginx: si encuentra 'index.html', lo sirve. 
    # Si no, devuelve 403 Forbidden, que es lo que queremos)
    
    # 4. Requisito: La subcarpeta /productes debe ser VISIBLE y LISTABLE
    location /productes {
        autoindex on;
        # La directiva 'root' se hereda, pero a veces es bueno reafirmarla
        # root /var/www/siurells.local/html; 
    }

    # 5. Requisito: La subcarpeta /nomines NO debe ser visible ni listable
    location /nomines {
        # Devuelve un error 404 Not Found inmediatamente.
        # Esto es m치s seguro que un 403 Forbidden, ya que no revela la existencia del directorio.
        return 404;
    }

    # Registro de errores y acceso para este sitio (Requisito 6)
    error_log /var/log/nginx/siurells.local_error.log;
    access_log /var/log/nginx/siurells.local_access.log;
}
```

#### B. Configuraci칩n para `www.ximbombes.local`

Crea y edita el archivo: `sudo nano /etc/nginx/sites-available/ximbombes.local.conf`

```nginx
server {
    listen 80;
    listen [::]:80;

    server_name ximbombes.local www.ximbombes.local;
    root /var/www/ximbombes.local/html;
    index index.html index.htm;

    # 3. Requisito: La carpeta ra칤z NO debe listarse (por defecto)

    # 4. Requisito: La subcarpeta /productes debe ser VISIBLE y LISTABLE
    location /productes {
        autoindex on;
    }

    # 5. Requisito: La subcarpeta /nomines NO debe ser visible ni listable
    location /nomines {
        return 404;
    }

    # Registro de errores y acceso para este sitio (Requisito 6)
    error_log /var/log/nginx/ximbombes.local_error.log;
    access_log /var/log/nginx/ximbombes.local_access.log;
}
```

-----

### 4\. Activaci칩n y Aplicaci칩n de Cambios

Sigue estos pasos para activar las configuraciones y recargar Nginx.

1.  **Desactivar la Configuraci칩n Predeterminada** (para evitar conflictos si el tr치fico se dirige a la IP del servidor):

    ```bash
    sudo unlink /etc/nginx/sites-enabled/default
    ```

2.  **Habilitar los Nuevos Sitios** (crear los enlaces simb칩licos):

    ```bash
    sudo ln -s /etc/nginx/sites-available/siurells.local.conf /etc/nginx/sites-enabled/
    sudo ln -s /etc/nginx/sites-available/ximbombes.local.conf /etc/nginx/sites-enabled/
    ```

3.  **Verificar la Sintaxis** (춰Crucial\!):

    ```bash
    sudo nginx -t
    # Deber칤a devolver: "syntax is ok" y "test is successful"
    ```

4.  **Recargar Nginx** para aplicar los cambios:

    ```bash
    sudo systemctl reload nginx
    ```

### 5\. Prueba de Requisitos (Resumen)

| URL Solicitada | Bloque Nginx Aplicado | Resultado Esperado | Requisito |
| :--- | :--- | :--- | :--- |
| `http://www.siurells.local/` | `server` | Sirve `index.html` | 3. Ra칤z no listable |
| `http://www.siurells.local/productes/` | `location /productes` | **Lista el contenido** (gracias a `autoindex on;`) | 4. Listable |
| `http://www.siurells.local/nomines/` | `location /nomines` | Error **404 Not Found** (gracias a `return 404;`) | 5. No visible/listable |