## 1\. üîë Generaci√≥n y Firma del Certificado (Mismo Proceso)

Este paso es id√©ntico al de Apache, ya que utiliza OpenSSL en tu Autoridad de Certificaci√≥n (CA).

### 1.1. Crear Archivo de Extensi√≥n (SAN)

Crea el archivo de configuraci√≥n para incluir los dominios (`www.siurells.local` y `siurells.local`) para el **Subject Alternative Name (SAN)**:

```bash
nano siurells.local.ext
```

**Contenido de `siurells.local.ext`:**

```conf
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = www.siurells.local
DNS.2 = siurells.local
```

### 1.2. Generar Clave, CSR y Certificado Firmado

Ejecuta estos comandos en tu CA. Aseg√∫rate de poner **`www.siurells.local`** como **Common Name (CN)**.

```bash
# 1. Generar Clave Privada
openssl genrsa -out siurells.local.key 2048

# 2. Generar CSR
openssl req -new -key siurells.local.key -out siurells.local.csr

# 3. Firmar el CSR usando tu CA y la extensi√≥n SAN
openssl x509 -req -in siurells.local.csr \
-CA acserver.pem \
-CAkey acserver.key \
-CAcreateserial \
-out siurells.local.crt \
-days 365 \
-extfile siurells.local.ext
```

-----

## 2\. üñ•Ô∏è Instalaci√≥n y Configuraci√≥n de NGINX

### 2.1. Mover los Archivos

Copia los tres archivos esenciales al servidor NGINX. NGINX suele usar la ruta `/etc/ssl/certs` o `/etc/ssl/private`. Crearemos una subcarpeta segura.

```bash
# Crear directorio seguro para los certificados
sudo mkdir -p /etc/nginx/ssl/siurells.local

# Copiar archivos
sudo cp siurells.local.key /etc/nginx/ssl/siurells.local/
sudo cp siurells.local.crt /etc/nginx/ssl/siurells.local/
sudo cp acserver.pem /etc/nginx/ssl/siurells.local/ca.crt
```

### 2.2. Configurar el Server Block de NGINX

Crea el archivo de configuraci√≥n para tu sitio. En NGINX, estos archivos van en `/etc/nginx/sites-available/`.

```bash
sudo nano /etc/nginx/sites-available/siurells.local.conf
```

**Contenido del Server Block de NGINX:**

Este archivo contendr√° **dos bloques `server`**: uno para la redirecci√≥n HTTP y otro para el tr√°fico HTTPS.

```nginx
# -----------------------------------------------
# Bloque 1: Redirecci√≥n HTTP (Puerto 80)
# -----------------------------------------------
server {
    listen 80;
    server_name www.siurells.local siurells.local;

    # üö® Redirecci√≥n 301 (permanente) a HTTPS
    return 301 https://$host$request_uri;
}

# -----------------------------------------------
# Bloque 2: Tr√°fico HTTPS (Puerto 443)
# -----------------------------------------------
server {
    listen 443 ssl;
    server_name www.siurells.local siurells.local;
    root /var/www/siurells.local/html; # Ajusta a la ruta real de tu web
    index index.html index.htm;

    # Rutas a los certificados
    ssl_certificate /etc/nginx/ssl/siurells.local/siurells.local.crt;
    ssl_certificate_key /etc/nginx/ssl/siurells.local/siurells.local.key;

    # üí° NGINX usa ssl_trusted_certificate para la cadena de CA (tu CA ra√≠z)
    # Sin esto, algunos navegadores podr√≠an fallar la verificaci√≥n.
    ssl_trusted_certificate /etc/nginx/ssl/siurells.local/ca.crt;

    # Configuraci√≥n de seguridad SSL/TLS recomendada
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
}
```

-----

## 3\. üöÄ Activar y Reiniciar NGINX

### 3.1. Activar el Server Block

Crea un enlace simb√≥lico desde `sites-available` a `sites-enabled`:

```bash
sudo ln -s /etc/nginx/sites-available/siurells.local.conf /etc/nginx/sites-enabled/
```

### 3.2. Verificar la Configuraci√≥n y Reiniciar

1.  **Verifica la sintaxis** de NGINX:

    ```bash
    sudo nginx -t
    # Debe decir: syntax is ok / test is successful
    ```

2.  **Reinicia NGINX** para aplicar la configuraci√≥n:

    ```bash
    sudo systemctl restart nginx
    ```

-----
