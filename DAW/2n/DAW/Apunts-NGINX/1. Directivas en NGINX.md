# Directivas en NGINX: Guía de Configuración

Las **directivas** en NGINX (pronunciado *Engine-X*) son **instrucciones de configuración** que le dicen al servidor proxy inverso, servidor web y *load balancer* cómo procesar las peticiones y gestionar el tráfico. A diferencia de Apache, la configuración de NGINX se basa en un diseño **modular** y **orientado a eventos**, centrándose en el rendimiento y la concurrencia.

-----

## 1\. Definición y Estructura Básica

Una directiva es un comando o instrucción de configuración. En NGINX, las directivas se dividen en dos categorías principales:

1.  **Directivas Simples**: Consisten en un nombre y uno o más parámetros, terminando siempre con un **punto y coma** (`;`).
2.  **Directivas de Bloque (*Block Directives*)**: Son directivas que actúan como **contenedores** y agrupan otras directivas (simples o de bloque), terminando con corchetes (`{}`).

### Estructura de una Directiva

Generalmente, una directiva simple se compone de un nombre de comando y sus argumentos:

`directiva argumento1 argumento2;`

  - **directiva**: El nombre del comando (ej. `listen`, `root`, `server_name`).
  - **argumentos**: Valores o parámetros necesarios para que la directiva funcione (ej. un puerto, una ruta, un nombre de host).

**Ejemplo de Directiva Simple:**

```nginx
listen 80;
root /var/www/html;
```

-----

## 2\. Contexto y Ubicación de las Directivas

Una característica esencial en la configuración de NGINX es la **jerarquía de contextos**, que define dónde puede ser utilizada una directiva y su ámbito de aplicación. La configuración se estructura en una serie anidada de bloques.

### Jerarquía de Contextos (Ámbito)

El contexto determina el **alcance** de la directiva, fluyendo desde el nivel superior (*main*):

| Contexto | Dónde se aplica | Descripción |
| :--- | :--- | :--- |
| **main** | Archivo de configuración principal | Aplica a la operación global del servidor (ej. configuración de usuario, número de *workers*). |
| **events** | Dentro de `events { ... }` | Configura el modelo de procesamiento de conexiones. |
| **http** | Dentro de `http { ... }` | Contiene directivas para *todos* los *virtual hosts* basados en HTTP/HTTPS (sitios web). |
| **server** | Dentro de `server { ... }` | Define un **Virtual Host** (dominio o sitio web) específico. Actúa como el contenedor `<VirtualHost>` de Apache. |
| **location** | Dentro de `location { ... }` | Aplica configuraciones a una **URI específica** (ruta web) dentro de un bloque `server`. Actúa como el contenedor `<Directory>` o `<Location>` de Apache. |

**Nota**: En NGINX, a diferencia de Apache, **no existen archivos de configuración distribuidos** como `.htaccess`. Toda la configuración debe hacerse en los archivos principales, lo que mejora el rendimiento.

### Ubicación Física

Estas directivas se encuentran principalmente en los **archivos de configuración** de NGINX:

1.  **`nginx.conf`**: El archivo de configuración principal, que contiene los contextos `main`, `events`, y `http`.
2.  **Archivos incluidos**: Es común incluir archivos externos para organizar la configuración (ej. dentro de un `http` se incluyen archivos del directorio `sites-enabled/` o *snippets* de configuración comunes).

-----

## 3\. Tipos de Directivas Comunes

Las directivas se clasifican según su función y el contexto en el que se utilizan.

### A. Directivas de Contenedores (*Block Directives*)

Son la base de la estructura de NGINX, agrupando otras directivas para definir su ámbito de aplicación:

| Contenedor | Contexto que define | Función Clave |
| :--- | :--- | :--- |
| **`http { ... }`** | *http* | Contiene la configuración global para el servicio web. |
| **`server { ... }`** | *server* | Define un **Virtual Host** (ej. `ejemplo.com`). Debe contener la directiva `listen`. |
| **`location [modificador] /ruta/ { ... }`** | *location* | Aplica configuraciones a una URL o patrón de URL específicos dentro de un `server`. |
| **`upstream { ... }`** | *http* | Define un grupo de servidores para balanceo de carga o *proxies*. |

**Ejemplo de Contenedor:**

```nginx
server {
    listen 80;
    server_name mi-dominio.com;

    location / {
        root /var/www/mi-dominio;
        index index.html;
    }
}
```

### B. Directivas de Entorno y Red (*Contextos server, http, main*)

Controlan la operación y la interfaz del servidor:

  - **`worker_processes`**: Define el número de procesos de trabajador que NGINX ejecutará (*contexto **main** o **events***).
  - **`listen`**: Especifica la dirección IP y el puerto donde el servidor debe escuchar las peticiones (ej. `listen 80;`).
  - **`server_name`**: Define los nombres de host (*dominios*) a los que responderá el bloque `server` (ej. `server_name www.ejemplo.com ejemplo.com;`).
  - **`root`**: Establece el directorio base para buscar archivos (similar a `DocumentRoot` en Apache, utilizado en *server* o *location*).

### C. Directivas de Contenido y Solicitud (*Contextos server, location*)

Controlan cómo se sirve el contenido y se procesan las peticiones:

  - **`index`**: Define los nombres de los archivos que NGINX buscará cuando se solicite un directorio (ej. `index index.html index.php;`).
  - **`try_files`**: Una directiva poderosa para la gestión de solicitudes y URLs. Permite probar la existencia de archivos, directorios y hacer *rewrites* internos, esencial para *Single Page Applications* (SPA) o sistemas CMS (ej. `try_files $uri $uri/ /index.php;`).
  - **`error_page`**: Permite definir una URI para mostrar errores específicos (ej. `error_page 404 /404.html;`).

### D. Directivas de Proxy Inverso y Balanceo de Carga

NGINX es frecuentemente usado como **proxy inverso**, enviando las peticiones a servidores de aplicaciones *backend*:

  - **`proxy_pass`**: Redirige una petición a la URL o *upstream* especificado (ej. `proxy_pass http://backend_servers;`).
  - **`proxy_set_header`**: Modifica o establece cabeceras HTTP que se envían al servidor *backend* (ej. `proxy_set_header Host $host;`).
  - **`server` (dentro de `upstream`)**: Define un servidor *backend* específico dentro de un grupo para balanceo de carga (ej. en `upstream backend_servers { server 192.168.1.100; }`).