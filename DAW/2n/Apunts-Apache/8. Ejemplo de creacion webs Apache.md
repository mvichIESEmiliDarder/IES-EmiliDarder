## 🚀 Guía Rápida: Apache2 y Múltiples Sitios Web

### 1\. Instalación y Preparación de Apache2

Instala Apache y ajusta el firewall (UFW):

```bash
# 1. Actualizar e Instalar Apache2
sudo apt update
sudo apt install apache2

# 2. Abrir el Firewall para HTTP y HTTPS
sudo ufw allow 'Apache Full'

# 3. Verificar el estado del servicio
sudo systemctl status apache2
```

-----

### 2\. Preparación del Sistema de Archivos

Crea las estructuras de directorios y ajusta los permisos. Al igual que con Nginx, usamos `/var/www/` para la raíz del contenido.

```bash
# 1. Crear las carpetas raíz de los dos sitios
sudo mkdir -p /var/www/siurells.es/html
sudo mkdir -p /var/www/ximbombes.cat/html

# 2. Crear las subcarpetas requeridas
sudo mkdir -p /var/www/siurells.es/html/nomines
sudo mkdir -p /var/www/siurells.es/html/productes

sudo mkdir -p /var/www/ximbombes.cat/html/nomines
sudo mkdir -p /var/www/ximbombes.cat/html/productes

# 3. Crear archivos de prueba (index.html)
echo "<h1>Benvinguts a Siurells (Apache)!</h1>" | sudo tee /var/www/siurells.es/html/index.html
echo "<h1>Benvinguts a Ximbombes (Apache)!</h1>" | sudo tee /var/www/ximbombes.cat/html/index.html

# 4. Asignar propiedad a www-data (usuario de Apache)
sudo chown -R www-data:www-data /var/www/siurells.es
sudo chown -R www-data:www-data /var/www/ximbombes.cat
```

-----

### 3\. Configuración de Hosts Virtuales (Virtual Hosts)

Vamos a configurar los dos sitios en archivos separados dentro de `/etc/apache2/sites-available/`.

#### A. Configuración para `www.siurells.es`

Crea y edita el archivo: `sudo nano /etc/apache2/sites-available/siurells.es.conf`

```apache
<VirtualHost *:80>
    # 1. Directivas principales del Virtual Host
    ServerName www.siurells.es
    ServerAlias siurells.es
    DocumentRoot /var/www/siurells.es/html
    DirectoryIndex index.html index.php
    
    # 6. Registro de errores y acceso (configuración necesaria)
    ErrorLog ${APACHE_LOG_DIR}/siurells.es_error.log
    CustomLog ${APACHE_LOG_DIR}/siurells.es_access.log combined

    # 3. Requisito: Configuración de la carpeta Raíz
    # (El directorio padre hereda los permisos base)
    <Directory /var/www/siurells.es/html>
        Options FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # 4. Requisito: La subcarpeta /productes debe ser VISIBLE y LISTABLE
    <Directory /var/www/siurells.es/html/productes>
        # 'Indexes' habilita el listado de archivos
        Options Indexes FollowSymLinks
        Require all granted
    </Directory>

    # 5. Requisito: La subcarpeta /nomines NO debe ser visible ni listable
    <Directory /var/www/siurells.es/html/nomines>
        # '-Indexes' deshabilita el listado.
        # 'Deny from all' bloquea cualquier acceso, resultando en 403 Forbidden.
        # Para que no sea visible (404), generalmente se usa un truco con RewriteEngine,
        # pero 'Require all denied' es el método más limpio de Apache para bloquear.
        Options -Indexes
        Require all denied
    </Directory>
</VirtualHost>
```

#### B. Configuración para `www.ximbombes.cat`

Crea y edita el archivo: `sudo nano /etc/apache2/sites-available/ximbombes.cat.conf`

```apache
<VirtualHost *:80>
    # 1. Directivas principales del Virtual Host
    ServerName www.ximbombes.cat
    ServerAlias ximbombes.cat
    DocumentRoot /var/www/ximbombes.cat/html
    DirectoryIndex index.html index.php

    # 6. Registro de errores y acceso (configuración necesaria)
    ErrorLog ${APACHE_LOG_DIR}/ximbombes.cat_error.log
    CustomLog ${APACHE_LOG_DIR}/ximbombes.cat_access.log combined

    # 3. Requisito: Configuración de la carpeta Raíz
    <Directory /var/www/ximbombes.cat/html>
        Options FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
    
    # 4. Requisito: La subcarpeta /productes debe ser VISIBLE y LISTABLE
    <Directory /var/www/ximbombes.cat/html/productes>
        Options Indexes FollowSymLinks
        Require all granted
    </Directory>

    # 5. Requisito: La subcarpeta /nomines NO debe ser visible ni listable
    <Directory /var/www/ximbombes.cat/html/nomines>
        Options -Indexes
        Require all denied
    </Directory>
</VirtualHost>
```

-----

### 4\. Activación y Aplicación de Cambios

Sigue estos pasos para activar las configuraciones y recargar Apache.

1.  **Desactivar la Configuración Predeterminada:**

    ```bash
    sudo a2dissite 000-default.conf
    ```

2.  **Habilitar los Nuevos Sitios** (usando el comando de conveniencia):

    ```bash
    sudo a2ensite siurells.es.conf
    sudo a2ensite ximbombes.cat.conf
    ```

3.  **Verificar la Sintaxis** (¡Crucial\!):

    ```bash
    sudo apachectl configtest
    # Debería devolver: "Syntax OK"
    ```

4.  **Recargar Apache** para aplicar los cambios:

    ```bash
    sudo systemctl reload apache2
    ```

### Resumen de Directivas Clave de Permisos

| Directiva Apache | Propósito | Resultado en el Navegador | Requisito |
| :--- | :--- | :--- | :--- |
| **`Options -Indexes`** (por defecto) | Previene el listado de directorios. | Sirve `index.html` o 403 Forbidden. | **3. Raíz** |
| **`Options Indexes`** | Permite el listado de archivos en el directorio. | Muestra la lista de archivos. | **4. Productes** |
| **`Require all denied`** | Deniega completamente el acceso al directorio. | Error 403 Forbidden. | **5. Nomines** |