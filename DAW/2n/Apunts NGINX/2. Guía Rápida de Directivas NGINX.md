## 游늶 Directivas Clave de Nginx y su Funci칩n

Las directivas en Nginx se agrupan en **contextos**: `main` (global), `events`, `http`, `server` (equivalente al Virtual Host de Apache), y `location`.

---

### Contexto `main` (Global)

Estas directivas se encuentran al inicio del archivo `nginx.conf` y afectan a todo el servidor.

| Directiva | Prop칩sito |
| :--- | :--- |
| **`user`** `www-data;` | Define el usuario y/o grupo bajo el cual Nginx ejecutar치 sus procesos de trabajo (workers). |
| **`worker_processes`** `auto;` | Define el n칰mero de procesos de trabajo. Se recomienda usar `auto` (para igualar el n칰mero de n칰cleos de CPU) o un valor espec칤fico. |
| **`error_log`** `/var/log/nginx/error.log;` | Especifica la ubicaci칩n del archivo de registro de errores y el nivel de gravedad (p. ej., `info`, `warn`, `error`). |
| **`pid`** `/run/nginx.pid;` | Especifica la ruta al archivo que almacena el ID del proceso principal de Nginx (PID). |

---

### Contexto `http`

Este contexto contiene directivas que influyen en el manejo de peticiones web (HTTP) y encapsula todos los bloques `server`.

| Directiva | Prop칩sito |
| :--- | :--- |
| **`include`** `/etc/nginx/mime.types;` | Incluye archivos de configuraci칩n de otras ubicaciones. Se usa com칰nmente para cargar tipos MIME y configuraciones de `sites-enabled`. |
| **`default_type`** `application/octet-stream;` | Define el tipo MIME predeterminado para las respuestas si no se puede determinar. |
| **`access_log`** `/var/log/nginx/access.log;` | Define la ubicaci칩n y el formato del archivo de registro de acceso (peticiones recibidas). |
| **`sendfile`** `on;` | Habilita la copia directa de datos del disco al socket, aumentando la eficiencia en el manejo de archivos est치ticos. |
| **`keepalive_timeout`** `65;` | Define el tiempo de espera para que una conexi칩n `keep-alive` con el cliente se cierre. |
| **`gzip`** `on;` | Habilita la compresi칩n Gzip para reducir el tama침o de los datos transferidos, mejorando la velocidad de carga. |

---

### Contexto `server` (Bloque de Servidor / Virtual Host)

Define la configuraci칩n para un sitio web o dominio espec칤fico.

| Directiva | Prop칩sito |
| :--- | :--- |
| **`listen`** `80;` | Define la IP y/o puerto en el que el servidor escuchar치 las peticiones (p. ej., `80` para HTTP, `443 ssl` para HTTPS). |
| **`server_name`** `ejemplo.com www.ejemplo.com;` | **춰Clave!** Especifica los nombres de dominio a los que este bloque de servidor debe responder. |
| **`root`** `/var/www/ejemplo/html;` | **춰Clave!** Define el directorio ra칤z del sitio web donde Nginx buscar치 los archivos solicitados (equivalente a `DocumentRoot`). |
| **`index`** `index.html index.php;` | Define la lista de archivos que Nginx buscar치 dentro de un directorio si solo se solicita la URL del directorio (p. ej., `http://ejemplo.com/`). |

---

### Contexto `location`

Define c칩mo Nginx maneja las peticiones para una URI espec칤fica dentro del bloque `server` (p. ej., la ruta `/api/`, la extensi칩n `.php`, o la ruta ra칤z `/`).

| Directiva | Prop칩sito |
| :--- | :--- |
| **`location`** `/ruta/` `{...}` | Define un bloque de configuraci칩n que se aplica solo a las peticiones que coinciden con la URI (`/ruta/`). |
| **`try_files`** `$uri $uri/ =404;` | **춰Clave!** Esencial para el enrutamiento de peticiones. Intenta servir archivos en el orden especificado. Por ejemplo, busca el archivo (`$uri`), luego el directorio (`$uri/`), y si no encuentra nada, devuelve un error (`=404`). |
| **`proxy_pass`** `http://backend_server;` | Dirige la petici칩n a otro servidor (com칰n cuando Nginx act칰a como **Proxy Inverso** o _Reverse Proxy_). |
| **`rewrite`** `^/antigua/ /nueva/ permanent;` | Permite reescribir la URI de la petici칩n utilizando expresiones regulares. |
| **`autoindex`** `on;` | Habilita el listado de archivos dentro de un directorio si no se encuentra un archivo `index` (equivalente a `Options +Indexes` de Apache). |
| **`allow`** `192.168.1.1;` | Permite el acceso desde la IP especificada. |
| **`deny`** `all;` | Deniega el acceso a la ubicaci칩n para todos (o la IP especificada). |